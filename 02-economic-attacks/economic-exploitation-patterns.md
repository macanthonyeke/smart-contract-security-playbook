# Economic Exploitation Patterns

## Overview
Economic exploits extract value without necessarily violating low-level access control or arithmetic safety. The attacker manipulates market microstructure, oracle inputs, liquidity assumptions, and governance mechanics so protocol rules produce adversarially favorable outcomes.

## Core Mental Model
Assume an attacker can source large temporary capital (flash loans), control transaction ordering (MEV participation), and route through multiple venues atomically. Security target: under worst-case liquidity/oracle/orderflow assumptions, protocol transitions should not offer positive expected value to an attacker net of costs.

## Minimal Vulnerable Example (Solidity or pseudocode)
```solidity
function borrow(uint256 collateralAmount) external {
    uint256 p = spotOracle.getPrice(collateral); // single-venue spot
    uint256 value = collateralAmount * p;
    uint256 limit = value * LTV / 1e18;
    debt[msg.sender] += limit;
    stable.mint(msg.sender, limit);
}
```

## Realistic Exploit Scenario (step-by-step transaction flow)
1. Attacker takes flash loan of base asset.
2. Attacker buys collateral aggressively on thin pool, pushing spot price up.
3. Protocol reads manipulated spot oracle in same block.
4. Attacker borrows maximum stablecoins against inflated collateral value.
5. Attacker unwinds price manipulation trade and repays flash loan.
6. Protocol remains with undercollateralized position and eventual bad debt.

Additional patterns:
- **Liquidity illusion attack**: attacker seeds temporary concentrated liquidity to pass liquidity checks, then removes liquidity before liquidation/exit pathways execute.
- **Governance capture via flash loans**: attacker borrows governance token, votes malicious proposal, executes if snapshot/delay model is weak.
- **Reflexive liquidation cascade**: parameter design (high liquidation bonus + shallow liquidity) triggers cascading sells, deepening insolvency.
- **MEV amplification**: searchers sandwich protocol interactions (deposits, rebalances, liquidations), extracting user value and destabilizing peg/solvency assumptions.

## Defensive Design Patterns
- **Robust oracles**: TWAPs, multi-source medianization, staleness and deviation bounds, liquidity-aware confidence checks.
- **Snapshot hardening**: governance voting power from pre-committed snapshots with non-borrowable/seasoned balances.
- **Execution delays and circuit breakers**: pause or throttle borrowing/liquidation under abnormal volatility or oracle divergence.
- **Liquidity-adjusted risk limits**: caps based on realizable depth, not nominal TVL.
- **Auction/liquidation design**: anti-cascade mechanisms (dynamic discounts, partial liquidation bands, cooldowns).
- **MEV-aware execution**: commit-reveal, batch auctions, private orderflow options for sensitive operations.

## EVM-Level Reasoning
- Flash loans enable near-unbounded intra-transaction balance sheet expansion.
- Same-block oracle reads from manipulable AMM state are economically insecure despite code correctness.
- Atomic composability lets attackers chain manipulation, borrow, and unwind without residual directional risk.
- Transaction ordering is adversarial; mempool visibility allows deterministic front-run/back-run strategies.

## Common Developer Mistakes
- Treating spot AMM price as oracle truth.
- Assuming minimum liquidity checks based on instantaneous pool state.
- Ignoring governance borrowability and vote snapshot timing.
- Designing liquidation incentives without market impact modeling.
- Evaluating security under average-case, not worst-case, execution ordering.

## Explicit, Strong Invariants
- **Worst-case EV invariant**: for modeled attacker capabilities (flash capital + MEV ordering), expected protocol loss per atomic strategy is non-positive after fees, slippage, and safeguards.
- **Oracle integrity invariant**: borrow limit cannot increase materially from single-block price impact alone.
- **Governance integrity invariant**: proposal execution power cannot be obtained and exercised within one borrowable-liquidity window.
- **Liquidation solvency invariant**: after any liquidation sequence, system bad debt remains below defined bound under stressed liquidity assumptions.
- **MEV resilience invariant**: user/account state transitions remain within bounded slippage and cannot be systematically extracted beyond configured tolerance.
